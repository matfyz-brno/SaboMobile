## Purpose
Short, actionable guidance for AI coding agents working on this repo (Cypress E2E tests for a BMI demo app).

## Quick commands
- Install: `npm install`
- Verify Cypress: `npm run cy:verify`
- Open interactive runner: `npm run cy:open`
- Run headless tests (CI): `npm test` (alias for `npm run cy:run`)
- Run headed / specific browser: `npm run test:headed`, `npm run test:chrome`, `npm run test:firefox`

## Big picture
- Purpose: this repo contains Cypress E2E tests for the BMI app at `https://practice.expandtesting.com` (see `cypress.config.js` `baseUrl`).
- Structure: tests under `cypress/e2e/`, reusable helpers under `cypress/support/` (notably `commands.js` and `e2e.js`), and test data in `cypress/fixtures/bmi-test-data.json`.

## Key project-specific patterns (use these — do not reinvent)
- Centralized setup: tests call `cy.visitWithSetup()` to visit pages with ad-blocking, popup handling and stability checks (`cypress/support/commands.js`). Prefer this over raw `cy.visit()`.
- High-level helpers: use `cy.calculateBMI(height, weight, unit)` and `cy.getBMIElements()` for interacting with the form; these encapsulate selectors and unit selection logic.
- Stability helpers: `cy.waitForStablePage()` and `cy.shouldBeVisibleAndInteractable()` are used throughout to reduce flakiness.
- Ad blocking: `cy.setupAdBlocking()` is invoked globally in `cypress/support/e2e.js` `beforeEach()` — tests assume many external requests are intercepted/blocked.

## Config and runtime details to respect
- `cypress.config.js` sets timeouts (defaultCommandTimeout 10000, pageLoadTimeout 30000), retries (`runMode: 2`) and `chromeWebSecurity: false`. Tests assume these settings.
- Video and screenshots are enabled; failure artifacts are written into `cypress/videos/` and `cypress/screenshots/`.
- Support file is `cypress/support/e2e.js` (importing `commands.js`). It suppresses certain uncaught exceptions — do not remove this unless you verify tests still run.

## Testing conventions and examples
- Data-driven: use fixtures from `cypress/fixtures/bmi-test-data.json` with `cy.fixture('bmi-test-data')` for parameterized checks.
- Prefer helper usage example:

```javascript
// good: uses helpers and yields stable test
cy.visitWithSetup('/bmi')
cy.calculateBMI(170, 70, 'metric')
cy.get('body').should('contain.text', '24')
```

Avoid low-level repeated selector logic in tests — add/extend helpers in `cypress/support/commands.js` when necessary.

## Debugging & CI notes
- For interactive debugging use `npm run cy:open` (time-travel, DOM inspector). For CI logs/artifacts rely on screenshots/videos generated by headless runs (`npm test`).
- CI-friendly behavior: tests are written to retry in `runMode` and capture artifacts; maintain idempotency and avoid global state.

## When changing tests or selectors
- Update `cypress/support/commands.js` helper selectors (`getBMIElements`) instead of changing every test.
- If a new popup pattern appears, add its selector to `handlePopups()` in `commands.js`.

## Files to inspect first when asked to make changes
- `cypress/e2e/bmi-calculator.cy.js` — canonical test patterns.
- `cypress/support/commands.js` — helper APIs and ad-blocking logic.
- `cypress/support/e2e.js` — global hooks and exception handling.
- `cypress.config.js` — timeouts, retries, baseUrl, and browser launch args.
- `package.json` — npm scripts for running and debugging tests.

## Output expectations for PRs from agents
- Keep tests stable and focused; when adding selectors/helpers include at least one test demonstrating usage and update `README.md` if you add new scripts.
- Provide a short PR description listing the changed helper(s) and why (example selectors added, new popup handled, improved stability).

---
If any part of this guidance is unclear or you want me to expand examples (selectors, fixtures, CI steps), tell me which area to iterate on.
